<div class='container' style='max-width: 600px; margin: 0 auto;'>
  <h1>{{news.title}}</h1>
  <div style='display: flex; justify-content: space-between '>
    <p>Автор: {{news.author}}</p>
    {{#if news.countView}}
    <p>Количество просмотров: {{news.countView}}</p>
    {{/if}}
  </div>
  <img src='{{news.cover}}' alt='news' style='width: 100%; height: 100%;' />
  <p class='mt-4'>{{news.description}}</p>
  <div style='margin: 30px 0 0 0'>
    <h5>Комментарии: {{comments.length}}</h5>
    <form id="create-comment-form">
      <div class="mb-3">
        <label for="authorInput" class="form-label">Автор</label>
        <input class="form-control" name="author" id="authorInput" placeholder="Введите свой ник" required>
      </div>
      <div class="mb-3">
        <label for="textInput" class="form-label">Описание</label>
        <textarea class="form-control" name="text" id="textInput" rows="3" placeholder="Написать комментарий" required></textarea>
      </div>
      <div class="form-group">
        <label class="mr-3" for="avatar">Аватар</label>
        <input type="file" class="form-control-file" name="avatar" id="avatar">
      </div>
      <button class="btn btn-primary mt-3" type="button" onclick="sendForm()">Отправить</button>
    </form>
    {{#if comments}}
    <ul style="margin-left: 0; padding-left: 0"></ul>
      {{#each comments}}
      <li class="mb-3 mt-4" style="list-style-type: none;">
          <div style="width: 100%; display: flex; align-items: center; margin: 0 0 10px 0; ">
            {{#if this.avatar}}
            <img 
              src={{this.avatar}} 
              alt="user-avatar" 
              style="margin-right: 10px; width: 32px; height: 32px; border-radius: 25px; "
            />
            {{else}}
            <div 
              style="margin-right: 10px; width: 32px; height: 32px; border-radius: 25px; background-color: grey; "
            ></div>
            {{/if}}
            <p style="margin: 0; ">{{this.author}}</p>
          </div>
          <p>{{this.text}}</p>
      </li>
      {{/each}}
    </ul>
    {{else}}
    <p class="mt-4">Комментариев пока нет. Вы можете быть первым.</p>
    {{/if}}
  </div>
</div>
<script>
  async function sendForm() {
    const form = document.getElementById('create-comment-form');
    const data = new FormData(form);
    const newsId = window.location.pathname.split('/').at(-2);
    await fetch(`/comments/${newsId}`, {
      method: 'POST',
      body: data
    });
    window.location.reload();
    alert('Комментарий создан.');
  }
</script>